<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <!-- <script src="api.js" defer></script> -->
  </head>

  <body>
    <form>
      <label for="track">Track</label><br />
      <input type="text" id="track" /><br />
      <label for="artist">Artist</label><br />
      <input type="text" id="artist" /><br />
      <input id="submit" type="button" value="Submit" />
    </form>
  </body>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.1/firebase-app.js";
    import {
      getDatabase,
      get,
      child,
      update,
      remove,
      set,
      ref,
      onValue,
    } from "https://www.gstatic.com/firebasejs/9.1.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAet6gHh72xSAlXNXUHejyTZzybRwe8L4M",
      authDomain: "good-listens-2885b.firebaseapp.com",
      projectId: "good-listens-2885b",
      storageBucket: "good-listens-2885b.appspot.com",
      messagingSenderId: "41185449889",
      appId: "1:41185449889:web:ffa9d80c9b4adc8d33dde0",
      measurementId: "G-3YP60LP1M1",
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase();

    async function insertData(track) {
      set(ref(db, "songs/" + track.mbid), {
        album: track.album.title,
        image: track.album.image[1]["#text"],
        artist: track.artist.name,
        name: track.name,
        url: track.url,
        user_rating: { uid: "", rating: 0 },
        avg_rating: 0,
        total_users: 0,
      });
    }

    async function selectData() {
      const dbRef = ref(db);
      get(child(dbRef, "songs/")).then((snapshot) => {
        if (snapshot.exists()) {
          console.log(snapshot.val());
        } else {
          alert("No data");
        }
      });
    }

    selectData();

    var submitBtn = document.getElementById("submit");
    const root_url = "http://ws.audioscrobbler.com/2.0";
    const api_key = "4a16f1c32796c466a1347458ab1626f4";
    async function getData(track, artist) {
      track = track.replace(/ /g, "_");
      artist = artist.replace(/ /g, "_");
      const url = `${root_url}/?method=track.getInfo&api_key=${api_key}&artist=${artist}&track=${track}&format=json`;
      console.log(url);
      const response = await fetch(url, {
        method: "GET",
        headers: {
          "Content-Type": "application/json",
        },
      });
      const data = await response.json();
      console.log(data.track);
      // console.log(data.track.album.title, data.track.album.image[1]["#text"], data.track.artist.name, data.track.name, data.track.url)
      insertData(data.track);
    }
    async function loopData() {
      const tracks = ["Watermelon Sugar", "Adore You", "Fine Line"];
      const artists = ["Harry Styles", "Harry Styles", "Harry Styles"];
      let i = 0;
      while (i < tracks.length) {
        getData(tracks[i], artists[i]);
        i++;
      }
    }

    submitBtn.addEventListener("click", function () {
      loopData();
    });
  </script>

  <script
    src="https://unpkg.com/react/umd/react.production.min.js"
    crossorigin
  ></script>

  <script
    src="https://unpkg.com/react-dom/umd/react-dom.production.min.js"
    crossorigin
  ></script>

  <script
    src="https://unpkg.com/react-bootstrap@next/dist/react-bootstrap.min.js"
    crossorigin
  ></script>
</html>
